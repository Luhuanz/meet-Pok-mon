import os
import time
import logging
from typing import List, Dict, Optional
from functools import lru_cache
from datetime import datetime, timedelta

from tavily import TavilyClient

# ========== 日志配置 ==========

logger = logging.getLogger("IndustrialWebSearcher")
logger.setLevel(logging.INFO)

# 控制台输出日志:
if not logger.handlers:
    console_handler = logging.StreamHandler()
    console_handler.setLevel(logging.INFO)
    formatter = logging.Formatter(
        fmt="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
        datefmt="%Y-%m-%d %H:%M:%S"
    )
    console_handler.setFormatter(formatter)
    logger.addHandler(console_handler)


# ========== 自定义异常类型 ==========

class MissingAPIKeyError(Exception):
    """自定义异常：未设置 TAVILY_API_KEY 环境变量时抛出。"""
    pass


class TavilySearchError(Exception):
    """自定义异常：调用 Tavily API 失败时抛出。"""
    pass


def _validate_api_key(api_key: Optional[str]) -> str:
    """
    验证并返回可用的 API Key，如果无效则抛出自定义异常。
    """
    if not api_key:
        raise MissingAPIKeyError("环境变量TAVILY_API_KEY未设置，无法初始化TavilyClient。")
    return api_key


def _extract_search_results(raw_results: Dict, max_results: int) -> List[Dict]:
    """
    从 Tavily 返回的原始数据中，提取并格式化所需字段。

    Args:
        raw_results: Tavily 返回的原始字典数据，如 {'results': [...] }
        max_results: 最大结果数量

    Returns:
        格式化后的搜索结果列表
    """
    if not raw_results or "results" not in raw_results:
        logger.warning("Tavily API 返回内容为空或格式异常。")
        return []

    extracted = []
    for item in raw_results['results'][:max_results]:
        extracted.append({
            'title': item.get('title', ''),
            'content': item.get('content', ''),
            'url': item.get('url', ''),
            'score': item.get('score', 0)
        })

    return extracted


# ========== 工业级搜索器类 ==========

class IndustrialWebSearcher:
    """
    工业级网络搜索器：
    - 负责初始化 TavilyClient
    - 提供搜索功能（含缓存与异常处理）
    - 提供搜索结果格式化功能
    """

    def __init__(self, api_key: Optional[str] = None, cache_ttl_minutes: int = 10):
        """
        初始化 IndustrialWebSearcher 实例。

        Args:
            api_key: Tavily 的 API Key，不指定则从环境变量中读取。
            cache_ttl_minutes: 缓存中每条搜索结果的有效期，单位分钟。默认 10 分钟。
        """
        # 若未传入 key，则从环境变量获取
        self.api_key = _validate_api_key(api_key or os.getenv("TAVILY_API_KEY"))
        self.client = TavilyClient(self.api_key)
        self.cache_ttl = timedelta(minutes=cache_ttl_minutes)

        # 用于缓存搜索结果：结构 { query_str: {"results": [...], "expires_at": datetime } }
        self._search_cache: Dict[str, Dict] = {}

        logger.info("IndustrialWebSearcher 实例已创建。")

    def _is_cache_valid(self, query: str) -> bool:
        """
        检查缓存的搜索结果是否在有效期内。
        """
        if query not in self._search_cache:
            return False

        cache_entry = self._search_cache[query]
        if 'expires_at' not in cache_entry:
            return False

        return datetime.now() < cache_entry['expires_at']

    def _cache_results(self, query: str, results: List[Dict]) -> None:
        """
        缓存搜索结果到内存，设置过期时间。
        """
        self._search_cache[query] = {
            "results": results,
            "expires_at": datetime.now() + self.cache_ttl
        }

    def perform_search(self, query: str, max_results: int = 1, search_depth: str = "basic") -> List[Dict]:
        """
        对外暴露的主要搜索函数。带有缓存、错误处理等机制。

        Args:
            query: 搜索关键词
            max_results: 返回结果最大数量
            search_depth: Tavily 搜索深度，"basic" 或 "complete" 等

        Returns:
            搜索结果的列表，每个元素是一个包含 title、content、url、score 的字典。
        """
        # 1. 参数简单校验
        if not query.strip():
            logger.warning("查询字符串为空，将返回空结果。")
            return []

        if max_results <= 0:
            logger.warning("max_results 设置小于等于 0，返回空列表。")
            return []

        # 2. 检查缓存
        if self._is_cache_valid(query):
            logger.info(f"在缓存中命中搜索结果：'{query}'")
            return self._search_cache[query]["results"]

        # 3. 调用 Tavily 进行搜索
        start_time = time.time()
        try:
            logger.info(f"开始搜索: '{query}', 深度: {search_depth}, 期望结果数: {max_results}")
            raw_response = self.client.search(
                query=query,
                search_depth=search_depth,
                max_results=max_results
            )
        except Exception as e:
            logger.error(f"Tavily搜索时出现异常：{e}")
            # 如果在实际业务中需要重试或其他处理，可在此处进行。
            raise TavilySearchError(f"Tavily搜索异常：{e}")

        # 4. 解析并提取结果
        formatted_results = _extract_search_results(raw_response, max_results)

        # 5. 缓存结果
        self._cache_results(query, formatted_results)

        elapsed = time.time() - start_time
        logger.info(f"搜索完成，耗时: {elapsed:.2f} 秒, 返回 {len(formatted_results)} 条结果。")

        return formatted_results

    def format_results(self, results: List[Dict]) -> str:
        """
        将搜索结果格式化成易读文本。
        Args:
            results: perform_search 返回的搜索结果列表

        Returns:
            适合阅读的文本字符串
        """
        if not results:
            return "没有找到相关的网络搜索结果。"

        lines = []
        lines.append("以下是网络搜索结果：\n")

        for i, item in enumerate(results, 1):
            lines.append(f"{i}. 标题: {item['title']}")
            lines.append(f"   概要: {item['content']}")
            lines.append(f"   链接: {item['url']}")
            lines.append(f"   分数: {item['score']}\n")

        return "\n".join(lines)

    def clear_cache(self):
        """
        手动清空缓存。当你需要确保获取最新搜索结果或释放内存时可以调用。
        """
        self._search_cache.clear()
        logger.info("搜索缓存已清空。")
if __name__ == '__main__':
    searcher = IndustrialWebSearcher(api_key="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")
    # 要搜索的内容
    query_str = "李白生日？"
    # 调用 perform_search 进行搜索
    # max_results 为返回条数，search_depth 可选 "basic" / "complete" 等
    results = searcher.perform_search(query=query_str, max_results=3, search_depth="basic")

    # 输出搜索结果的原始数据结构

    print("=== 原始搜索结果 ===")
    for i, item in enumerate(results, 1):
        print(f"{i}. {item}")

    # 1.
    # {'title': '李白（唐代著名浪漫主义诗人）_百度百科',
    #  'content': '网页新闻贴吧知道网盘图片视频地图文库资讯采购百科 百度首页 登录 注册 进入词条 全站搜索 帮助 首页 秒懂百科 特色百科 知识专题 加入百科 百科团队 权威合作 个人中心 李白[lǐ bái] 播报 讨论 上传视频 唐代著名浪漫主义诗人展开73个同名词条 收藏 李白（701年2月28日—762年12月） [27]，字太白，号青莲居士 [19]，出生于蜀郡绵州昌隆县（今四川省绵阳市江油市青莲镇 [130]），一说山东人， [135-136]一说出生于西域碎叶 [28]，祖籍陇西成纪（今甘肃省秦安县）。唐朝伟大的浪漫主义诗人，凉武昭王李暠九世孙 [15] [22]。 为人爽朗大方，乐于交友，爱好饮酒作诗，名列“酒中八仙” [2]。曾经得到唐玄宗李隆基赏识，担任翰林供奉 [125]，赐金放还后，游历全国，先后迎娶宰相许圉师、宗楚客的孙女。唐肃宗李亨即位后，卷入永王之乱，流放夜郎，辗转到达当涂县令李阳冰家。上元二年，去世，时年六十二 [15]。 著有《李太白集》 [25]，代表作有《望庐山瀑布》《行路难》《蜀道难》《将进酒》《早发白帝城》《黄鹤楼送孟浩然之广陵》等 [2]。李白所作词赋，就其开创意义及艺术成就而言，享有极为崇高的地位，后世誉为“诗仙”，与诗圣杜甫并称“李杜”。 全\xa0\xa0\xa0\xa0名 李白 [126] 别\xa0\xa0\xa0\xa0名 李十二 [139]、谪仙人、诗仙 太白 青莲居士 所处时代 唐朝 民族族群 汉族 [30] 出生地 蜀郡绵州昌隆县 [30]（一说出生于西域碎叶） 出生日期 701年2月28日 [27]（长安元年） 逝世日期 762年12月（宝应元年） 主要成就 古代浪漫主义文学高峰、歌行体和七绝的巅峰 [3] 主要作品 李太白集 性\xa0\xa0\xa0\xa0别 祖\xa0\xa0\xa0\xa0籍 陇西成纪（今甘肃省秦安县） 目录 1人物生平 ▪早年天才 ▪辞亲远游 ▪蹉跎岁月 ▪献赋谋仕 李白 天宝四载(745)秋天，李白离开长安，被唐玄宗赐金遣返，受族弟李凝之邀到单父（今山东省菏泽市单县），出猎消忧，曾留宿晏堌（今山东省菏泽市成武晏堌堆）写下《送族弟凝至晏堌单父三十里》。恰逢本家兄弟李沈也从咸阳（今属陕西）来到此地，于是李白、李沈、李凝兄弟3人欢聚、游猎。李沈要回秦地，李白、李凝在东楼上为他饯行。李白作此诗送别，写下《单父东楼秋夜送族弟沈之秦》。 [132-134] 李白 据统计，《全唐诗》李白诗中“剑”字共出现了一百零七次，除去作为地名的“剑阁”三次，“剑壁”一次，武器之“剑”犹有一百零三次之多。属于剑的“铗”出现了一次、“吴钩”一次、“吴鸿”一次、“湛卢”一次、“干将”一次、“莫邪”一次、“青萍”两次、“秋莲”两次、“霜雪”两次、“匕首”三次、“龙泉”四次。总计，“剑”字共出现了一百一十八次（统计时把“吴钩霜雪明”“空余湛卢剑”“剑花秋莲光出匣”“拙妻莫邪剑”“吾家青萍剑”分别计做一次），分布在一百零六首诗中，约占全诗总数的10%。 贯休：①日角浮紫气，凛然尘外清。虽称李太白，知是那星精。御宴千钟饮，蕃书一笔成。宜哉杜工部，不错道骑鲸。（《观李翰林真二首 其一》） [94]②谁氏子丹青，毫端曲有灵。屹如山忽堕，爽似酒初醒。天马难拢勒，仙房久闭扃。若非如此辈，何以傲彤庭。（《观李翰林真二首 其二》） [95] 范纯仁：李白千篇敏异常。（《到汉东和张伯常六首 其一》） [60] 苏轼：①“李太白、杜子美以英玮绝世之姿，凌跨百代，古今诗人尽废。然魏、晋以来，高风绝尘亦少衰矣。”（《书黄子思诗集后》）②李白当年流夜郎，中原无复汉文章。（《沿流馆中得二绝句 其二》） [70]③帝遣银河一派垂，古来惟有谪仙词。飞流溅沫知多少，不与徐凝洗恶诗。（《世传徐凝〈瀑布〉诗云：一条界破青山色。至为尘陋。又伪作乐天诗称美此句，有「赛不得」之语。乐天虽涉浅易，然岂至是哉！乃戏作一绝》） [79]④李太白，狂士也。又尝失节于永王璘，此岂济世之人哉？而毕文简公以王佐期之，不亦过乎？曰：士固有大言而无实，虚名不适于用者，然不可以料天下之士；士以气为主，方高力士用事，公卿大夫争事之，而太白使脱靴殿上，固已气盖天下矣。使之得志，必不肯附权幸以取容，其肯从君于昏乎？夏侯湛赞东方生云：“开济明豁，包容宏大。陵轹卿相，嘲哂豪杰。笼罩靡前，跆藉贵势。出不沐显，贱不忧戚。戏万乘若僚友，视俦列如草介。雄节迈论，高气盖世。可谓拔乎其萃，游方之外者也。”吾于太白亦云。太白之从永王璘，当由迫胁；不然，璘之狂肆寝陋，虽庸人知其必败也。太白识郭子仪之为人杰，而不能知璘之无成，此理之必不然者也。吾不可以不辨。（《李太白碑阴记》） [119] 孔平仲：①洒落风标真谪仙，精神犹恐笔难传。文章若出斯人手，壮浪雄豪一自然。（《李白祠堂 其一》） [64]②太白之精出李白，诗中元帅酒家豪。轩然眉目已如此，况著当年宫锦袍。（《李白祠堂 其二》） [65] 李廌：山东太白谪仙人，笔卷天河气拂云。（《钓台 其二》） [83] 李纲：①谪仙英豪盖一世，醉使力士如使奴。当时左右悉谀佞，惊怪恇怯应逃逋。我生端在千载后，祭公只用一束刍。遗编凛凛有生气，玩味无斁谁如吾。（《读李白集用奴字韵》） [67]②谪仙乃天人，薄游人间世。词章号俊逸，迈往有英气。明皇重其名，召见如绮季。万乘尚僚友，公卿何介蒂。脱靴使将军，故自非因醉。乞身归旧隐，来去同一戏。沈吟紫芝歌，缅邈青霞志。笑著宫锦袍，江山聊傲睨。肯从永王璘，此事不须洗。垂天赋大鹏，端为真隐子。神游八极表，捉月初不死。（《读四家诗选四首 其四 太白》） [84]③呜呼天宝间，治乱如反掌。兵戈暗中原，豪杰多长往。谪仙当此时，逸气隘天壤。脱身来江东，缥渺青霞赏。作诗几千篇，醉笔笼万象。（《游五松山观李太白祠堂》） [85] 释本才：红尘数尽去来人，李白元是痴措大。（《偈十二首 其二》） [72] 郭之奇：①苍松渺渺谪仙坟，采石矶头草木芬。此地江山空识李，唐朝内外不容君。词林气魄青莲重，诗酒风流白水分。闻道骑鲸非复是，春峰箕尾伫遥氛。（《过采石吊李白墓》） [42]②英豪相视一杯中，笑向金銮顾紫宫。貂作当年知己具，靴留千载侍臣风。《过采石吊李白墓四首 其一 一快其遇知章也》 [43]③主恩朋意两殊遭，知遇无缘答寸毫。只为宫阉多气色，故藏名姓入醇醪。《过采石吊李白墓四首 其四 一快其以酒相忘而伤其志也》 [44] 天宝四载',
    #  'url': 'https://baike.baidu.com/item/李白/1043', 'score': 0.84183896}
    # 2.
    # {'title': '李白 - 維基百科，自由的百科全書',
    #  'content': '李白 - 維基百科，自由的百科全書 2 生平切換 生平 子章節 3 文學切換 文學 子章節 5 宗教切換 宗教 子章節 李白 | 李白 | | 姓名 | 李白 | 唐代宗即位之初，曾封李白為左拾遺，但詔書送達時李白已去世[1]:3。李白一生個性熱烈，豪邁不羈，悟性超凡，詩才天縱[5]:148，具有飄逸不群的高士風骨[14]:3，足跡踏遍了大半個中國[15]:1。過世後，李陽冰把李白交給他的詩文編成《草堂集》10卷[5]:143。 詩歌寫孟浩然風雅之心遠近天下知名，放棄官位，在大自然中怡然自樂；詩人對其高潔品格獻上深深敬意[15]:174-175。《秋浦歌》其十五：「白髮三千丈，緣愁似箇長。不知明鏡裏，何處得秋霜？」白髮而說「三千丈」，語氣誇大至匪夷所思，特有李白那種浪漫得有點荒誕的味道[14]:306。 鳳凰臺上鳳凰遊，鳳去臺空江自流。吳宮花草埋幽徑，晉代衣冠成古丘。三山半落青天外，一水中分白鷺洲。總為浮雲能蔽日，長安不見使人愁[5]:322-323。 《為宋中丞祭九江文》是李白為幕主宋若思率兵安全渡過長江，祈禱江神而作；《為宋中丞請都金陵表》則是李白為宋若思向朝廷建議遷都金陵所寫，兩篇駢文都格調厚重，極盡委曲，風韻洋溢[5]:378。 李白傳世的墨跡，有藏於北京故宮博物院的《上陽臺》帖，帖文是「山高水長，物象萬千。非有老筆，清壯何窮？十八日上陽臺書。太白」[28]:110。李白到王屋山陽臺觀，就觀中天地宮府壁畫而題寫此帖，「老筆」乃指司馬承禎的繪畫[34]:349-350。李白尚有《嘲王歷陽不肯飲酒》帖傳世，全帖共50字，落款為李白。傅申指出，此帖「書風乾淨，有歐陽詢和褚遂良的骨架」，「用筆酣暢，縱橫自如」，應為753年（天寶十二年）李白與王歷陽飲酒時乘興所書。此帖經遣唐使攜帶到日本，2017年由香港李白詩詞書法研究會從日本藏家購得[37]。 方東樹也讚賞李白詩變化多端，非凡人夢想所能及，其妙處可與《莊子》媲美[14]:136、105。在現代中國大陸李白通常獲「熱愛祖國和人民」的評語[17]:29，高度評價為「偉大的積極浪漫主義詩人」，與杜甫並列[21]:63。後世所謂李杜比較論，大致將李、杜並列的，有韓愈、嚴羽、乾隆帝等；稱杜甫優先的，有白居易、元稹、王安石、蘇軾等[17]:240。於永王璘事件，自曾鞏以下，一些學者以李白被迫追隨李璘而為他辯解，洪亮吉則斥責李白為「失節」[1]:211。 李白 (電視劇) ISBN 9787101030037 （中文（簡體））. ISBN 9787108021663 （中文（簡體））. ISBN 9787101050745 （中文（簡體））. Nienhauser, Jr（英語：William H. 2003, 1: 32–36 [2024-11-28] （中文（簡體））. ISBN 7309030621 （中文（簡體））. Nienhauser, Jr（英語：William H. ISBN 9787101054057 （中文（簡體））. ISBN 9787101058789 （中文（簡體））. ISBN 9787020181131 （中文（簡體））. OCLC 885475792 （中文（簡體））. ISBN 7543429462 （中文（簡體））. ISBN 9787300010359 （中文（簡體））. ISBN 9787810757683 （中文（簡體））. ISBN 9787101046236 （中文（簡體））. ISBN 7500609833 （中文（簡體））. ISBN 9787101087086 （中文（簡體））. ISBN 9787108067012 （中文（簡體））. ISBN 7547508855 （中文（簡體））. 正修科技大學通識教育中心 (編). ISBN 9787101096316 （中文（簡體））. 陳偉強 (編). 2006, 5: 105–111 [2024-11-28] （中文（簡體））. ISBN 7220034156 （中文（簡體））. 2022-11-07 [2024-12-10] （中文（簡體））. 2022, 2: 251–268 [2024-11-28] （中文（簡體））. *   編 李白 本頁面最後修訂於2025年2月10日 (星期一) 13:37。 李白',
    #  'url': 'https://zh.wikipedia.org/zh-tw/李白', 'score': 0.53619206}
    # 3.
    # {'title': '李白 - 维基百科，自由的百科全书',
    #  'content': '李白 - 维基百科，自由的百科全书 李白 148种语言 | 李白 | | 姓名 | 李白 | 唐代宗即位之初，曾封李白為左拾遺，但詔書送達時李白已去世[1]:3。李白一生個性熱烈，豪邁不羈，悟性超凡，詩才天縱[5]:148，具有飄逸不群的高士風骨[14]:3，足跡踏遍了大半個中國[15]:1。過世後，李陽冰把李白交給他的詩文編成《草堂集》10卷[5]:143。 詩歌寫孟浩然風雅之心遠近天下知名，放棄官位，在大自然中怡然自樂；詩人對其高潔品格獻上深深敬意[15]:174-175。《秋浦歌》其十五：「白髮三千丈，緣愁似箇長。不知明鏡裏，何處得秋霜？」白髮而說「三千丈」，語氣誇大至匪夷所思，特有李白那種浪漫得有點荒誕的味道[14]:306。 鳳凰臺上鳳凰遊，鳳去臺空江自流。吳宮花草埋幽徑，晉代衣冠成古丘。三山半落青天外，一水中分白鷺洲。總為浮雲能蔽日，長安不見使人愁[5]:322-323。 在一些離別詩中，李白創造出栩栩如生、充滿神仙境界之光彩與玄秘的山景來，如《鳴皋歌送岑徵君》、《夢遊天姥吟留別》[1]:257-258。《夢遊天姥吟留別》是李白離開東魯前往江東時贈別所作[14]:99，沿襲楚辭的傳統[6]:166，描寫天姥山宏偉瑰麗的山水景色[18]:69，與驚心動魄的神仙境界，詩末抒發美夢易空的感嘆，認為卑躬屈膝追逐名利，不如無拘無束四處遨遊：「安能摧眉折腰事權貴，使我不得開心顏[1]:163。」《送友人入蜀》詩句「山從人面起，雲傍馬頭生」，描寫蜀道山勢陡峭，人馬在雲霧中爬行[25]:78。 李白遊仙詩描述詩人與眾仙遊走的盛大場面，攝人心魄，才情詩筆超凡絕俗[29]:703，著重描寫仙遊的樂趣，在遐想中拋開凡人的煩惱與限制，飄然暢遊天外絢麗奇異之地，享用珍饈美味[14]:58、60。李白詩充滿各種神仙故事，如東海蓬萊、方丈、瀛洲三仙山，西王母宴請周穆王、降訪漢武帝的傳說，其他仙人如赤松子、安期生、麻姑的異事，其神仙故事出自《史記》、《博物志》、《神仙傳》、《抱朴子》、《漢武帝內傳》等書[1]:251。遊仙詩《古風》其四引用了道經《靈寶五符》中吳王闔閭的故事[30]:215；《古風》其四十一寫詩人飄然暢遊天外許多絢麗奇異的地方，享用人世難求的美味，希望永遠願揚天外，不願回人間的故鄉。《擬古》其十用了麻姑和《桃花源記》的典故，所夢想的不是飛昇出世，而是就地成仙，獲昆崙山仙人的賜贈，在世上享受神仙的樂趣[1]:253-254。《至陵陽山登天柱石酬韓侍御見招隱黃山》宣稱詩人將拋棄凡人的形態，離開塵世，進入「無窮」之境[31]:9-10。 《為宋中丞祭九江文》是李白為幕主宋若思率兵安全渡過長江，祈禱江神而作；《為宋中丞請都金陵表》則是李白為宋若思向朝廷建議遷都金陵所寫，兩篇駢文都格調厚重，極盡委曲，風韻洋溢[5]:378。 李白把儒家的救世願望與隱士意識的出山入朝浪漫地結合在一起，熱烈地企求實現。他自認有義務且有能力成為濟度蒼生的救世者，期待能身居政府要職；同時要當一個不受權位與聲名羈絆的高士，因此希望能忽然成就大業，然後英雄式地從官場退隱。隱居山林可說是出仕濟民的準備階段[1]:149-150、152，遊仙是「養賢」的途徑，應該成為培養國家人才之所[5]:174。李白對政治夢想認真而熱切，對功名的渴求，有時使他忘卻或否定隱居生活的意義；有時政治上挫折感又會使李白安慰自己功名富貴是短暫的，不如安於自由的的隱居生活，或及時及樂一番[1]:160、162。李白不曾參加過科舉，無意像一般士人透過普通渠道慢慢往上爬，而是期待被直接舉薦為官，以顯得與眾不同。李白所述夢想充滿天才狂想[1]:169-170、249；施逢雨指出，李白誤認自己有政治長才，實際上他欠缺處理政務的智慧，沒有什麼政治洞見[1]:160、157-158；岡村繁認為李白對自己的政治才能有「幼稚自負的幻想」[5]:423。 李白傳世的墨跡，有藏於北京故宮博物院的《上陽臺》帖，帖文是「山高水長，物象萬千。非有老筆，清壯何窮？十八日上陽臺書。太白」[28]:110。李白到王屋山陽臺觀，就觀中天地宮府壁畫而題寫此帖，「老筆」乃指司馬承禎的繪畫[34]:349-350。李白尚有《嘲王歷陽不肯飲酒》帖傳世，全帖共50字，落款為李白。傅申指出，此帖「書風乾淨，有歐陽詢和褚遂良的骨架」，「用筆酣暢，縱橫自如」，應為753年（天寶十二年）李白與王歷陽飲酒時乘興所書。此帖經遣唐使攜帶到日本，2017年由香港李白詩詞書法研究會從日本藏家購得[37]。 方東樹也讚賞李白詩變化多端，非凡人夢想所能及，其妙處可與《莊子》媲美[14]:136、105。在現代中國大陸李白通常獲「熱愛祖國和人民」的評語[17]:29，高度評價為「偉大的積極浪漫主義詩人」，與杜甫並列[21]:63。後世所謂李杜比較論，大致將李、杜並列的，有韓愈、嚴羽、乾隆帝等；稱杜甫優先的，有白居易、元稹、王安石、蘇軾等[17]:240。於永王璘事件，自曾鞏以下，一些學者以李白被迫追隨李璘而為他辯解，洪亮吉則斥責李白為「失節」[1]:211。 李白 (電視劇) 台北: 台灣學生書局. ISBN 9787101030037 （中文（简体））. ISBN 9787108021663 （中文（简体））. ISBN 9787101050745 （中文（简体））. Nienhauser, Jr（英语：William H. 2003, 1: 32–36 [2024-11-28] （中文（简体））. ISBN 7309030621 （中文（简体））. Nienhauser, Jr（英语：William H. ISBN 9787101054057 （中文（简体））. ISBN 9787101058789 （中文（简体））. ISBN 9787020181131 （中文（简体））. 台北: 華宇出版社. 台北: 大安出版社. OCLC 885475792 （中文（简体））. ISBN 7543429462 （中文（简体））. ISBN 9787300010359 （中文（简体））. ISBN 9787810757683 （中文（简体））. ISBN 9787101046236 （中文（简体））. ISBN 7500609833 （中文（简体））. ISBN 9787101087086 （中文（简体））. 台北: 洪範書店. ISBN 9787108067012 （中文（简体））. ISBN 7547508855 （中文（简体））. 正修科技大學通識教育中心 (编). ISBN 9787101096316 （中文（简体））. 2006, 5: 105–111 [2024-11-28] （中文（简体））. ISBN 7220034156 （中文（简体））. 2022-11-07 [2024-12-10] （中文（简体））. 2022, 2: 251–268 [2024-11-28] （中文（简体））. *   编 李白 本页面最后修订于2025年2月7日 (星期五) 15:43。 李白 148种语言 添加话题',
    #  'url': 'https://zh.wikipedia.org/wiki/李白', 'score': 0.5172057}

    # 使用 searcher.format_results 格式化输出，便于阅读
    print("\n=== 格式化后的搜索结果 ===")
    formatted_text = searcher.format_results(results)
    print(formatted_text) #文本

    # 如果需要清空缓存，调用 clear_cache()
    # searcher.clear_cache()
